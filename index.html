<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËèúÂçïÁÇπÈ§êÁ≥ªÁªü</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f3f4f6;
        }
        #root {
            height: 100vh;
        }
        .icon {
            width: 16px;
            height: 16px;
        }
        .calendar-day {
            width: 14.28%;
            height: 40px;
        }
        .calendar-day.selected {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Ëá™ÂÆö‰πâÂõæÊ†áÁªÑ‰ª∂
        const Plus = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Minus = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Copy = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        const Trash2 = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const PlusCircle = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        );

        const X = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Edit3 = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
        );

        const BarChart3 = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 20V10"></path>
                <path d="M18 20V4"></path>
                <path d="M6 20v-4"></path>
            </svg>
        );

        const Calendar = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" 
                 strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        function MenuOrderApp() {
            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
            const loadFromStorage = (key, defaultValue) => {
                try {
                    const saved = localStorage.getItem(key);
                    return saved ? JSON.parse(saved) : defaultValue;
                } catch {
                    return defaultValue;
                }
            };

            // ÂàùÂßãËèúÂçïÊï∞ÊçÆ
            const [menuItems, setMenuItems] = useState(() => 
                loadFromStorage('menuItems', [
                    { id: 1, name: 'ÂÆ´‰øùÈ∏°‰∏Å', price: 38, category: 'ÁÉ≠Ëèú' },
                    { id: 2, name: 'È±ºÈ¶ôËÇâ‰∏ù', price: 32, category: 'ÁÉ≠Ëèú' },
                    { id: 3, name: 'È∫ªÂ©ÜË±ÜËÖê', price: 28, category: 'ÁÉ≠Ëèú' },
                    { id: 4, name: 'Ë•øÁ∫¢ÊüøÁÇíÈ∏°Ëõã', price: 22, category: 'ÁÉ≠Ëèú' },
                    { id: 5, name: 'Á≥ñÈÜãÊéíÈ™®', price: 48, category: 'ÁÉ≠Ëèú' },
                    { id: 6, name: 'ÈÖ∏Ëæ£Ê±§', price: 18, category: 'Ê±§ÂìÅ' },
                    { id: 7, name: 'ËõãËä±Ê±§', price: 15, category: 'Ê±§ÂìÅ' },
                    { id: 8, name: 'Á±≥È•≠', price: 3, category: '‰∏ªÈ£ü' },
                    { id: 9, name: 'È¶íÂ§¥', price: 2, category: '‰∏ªÈ£ü' },
                    { id: 10, name: 'ÁÇíÈ•≠', price: 18, category: '‰∏ªÈ£ü' },
                    { id: 11, name: 'ÂèØ‰πê', price: 5, category: 'ÈÖíÊ∞¥È•ÆÊñô' },
                    { id: 12, name: 'Èõ™Á¢ß', price: 5, category: 'ÈÖíÊ∞¥È•ÆÊñô' },
                    { id: 13, name: 'Âï§ÈÖí', price: 8, category: 'ÈÖíÊ∞¥È•ÆÊñô' },
                ])
            );

            const [orders, setOrders] = useState(() => loadFromStorage('orders', {}));
            const [copySuccess, setCopySuccess] = useState(false);
            const [showAddForm, setShowAddForm] = useState(false);
            const [showBatchAddForm, setShowBatchAddForm] = useState(false);
            const [showEditMode, setShowEditMode] = useState(false);
            const [showSummary, setShowSummary] = useState(false);
            const [newItem, setNewItem] = useState({ name: '', price: '', category: 'ÁÉ≠Ëèú', customCategory: '' });
            const [batchText, setBatchText] = useState('');
            const [batchCategory, setBatchCategory] = useState('ÁÉ≠Ëèú'); // ÊâπÈáèÊ∑ªÂä†ÁöÑÂàÜÁ±ª
            const [orderHistory, setOrderHistory] = useState(() => loadFromStorage('orderHistory', []));
            const [cancelledOrders, setCancelledOrders] = useState(() => loadFromStorage('cancelledOrders', []));
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [viewMode, setViewMode] = useState('daily'); // daily, monthly, items
            const [showCustomCategory, setShowCustomCategory] = useState(false);
            const [showCancelledOrders, setShowCancelledOrders] = useState(false); // ÊòæÁ§∫ÂèñÊ∂àÁöÑËÆ¢Âçï

            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            useEffect(() => {
                localStorage.setItem('menuItems', JSON.stringify(menuItems));
            }, [menuItems]);

            useEffect(() => {
                localStorage.setItem('orders', JSON.stringify(orders));
            }, [orders]);

            useEffect(() => {
                localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            }, [orderHistory]);

            useEffect(() => {
                localStorage.setItem('cancelledOrders', JSON.stringify(cancelledOrders));
            }, [cancelledOrders]);

            const updateQuantity = (itemId, change) => {
                setOrders(prev => {
                    const newQty = (prev[itemId] || 0) + change;
                    if (newQty <= 0) {
                        const { [itemId]: _, ...rest } = prev;
                        return rest;
                    }
                    return { ...prev, [itemId]: newQty };
                });
            };

            const addNewMenuItem = () => {
                if (!newItem.name || !newItem.price) {
                    alert('ËØ∑Â°´ÂÜôËèúÂêçÂíå‰ª∑Ê†º');
                    return;
                }
                
                // Â§ÑÁêÜÂàÜÁ±ª
                let category = newItem.category;
                if (category === 'ÂÖ∂‰ªñ' && newItem.customCategory.trim()) {
                    category = newItem.customCategory.trim();
                }
                
                const newId = Math.max(...menuItems.map(i => i.id), 0) + 1;
                setMenuItems([...menuItems, {
                    id: newId,
                    name: newItem.name,
                    price: parseFloat(newItem.price),
                    category: category
                }]);
                
                setNewItem({ name: '', price: '', category: 'ÁÉ≠Ëèú', customCategory: '' });
                setShowCustomCategory(false);
                setShowAddForm(false);
            };

            const batchAddMenuItems = () => {
                if (!batchText.trim()) {
                    alert('ËØ∑ËæìÂÖ•ËèúÂìÅ‰ø°ÊÅØ');
                    return;
                }

                const lines = batchText.split('\n').filter(line => line.trim());
                const newItems = [];
                let maxId = Math.max(...menuItems.map(i => i.id), 0);

                lines.forEach(line => {
                    // ÂåπÈÖçËèúÂêçÂíå‰ª∑Ê†ºÔºåÊîØÊåÅÂ§öÁßçÊ†ºÂºèÔºöËèúÂêç ‰ª∑Ê†º„ÄÅËèúÂêç Ôø•‰ª∑Ê†º„ÄÅËèúÂêç:‰ª∑Ê†º Á≠â
                    const match = line.match(/(.+?)\s+[Ôø•]?(\d+(?:\.\d{1,2})?)$/);
                    if (match) {
                        const name = match[1].trim();
                        const price = parseFloat(match[2]);
                        if (name && !isNaN(price)) {
                            newItems.push({
                                id: ++maxId,
                                name: name,
                                price: price,
                                category: batchCategory // ‰ΩøÁî®ÈÄâÊã©ÁöÑÂàÜÁ±ª
                            });
                        }
                    }
                });

                if (newItems.length > 0) {
                    setMenuItems([...menuItems, ...newItems]);
                    setBatchText('');
                    setShowBatchAddForm(false);
                    alert(`ÊàêÂäüÊ∑ªÂä† ${newItems.length} ‰∏™ËèúÂìÅ`);
                } else {
                    alert('Êú™ÊâæÂà∞ÊúâÊïàÁöÑËèúÂìÅ‰ø°ÊÅØÔºåËØ∑Ê£ÄÊü•Ê†ºÂºèÔºàÊØèË°åÊ†ºÂºèÔºöËèúÂêç ‰ª∑Ê†ºÔºâ');
                }
            };

            const deleteMenuItem = (itemId) => {
                if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËèúÂìÅÂêóÔºü')) {
                    setMenuItems(menuItems.filter(item => item.id !== itemId));
                    // ÂêåÊó∂Âà†Èô§ËØ•ËèúÂìÅÁöÑËÆ¢Âçï
                    setOrders(prev => {
                        const { [itemId]: _, ...rest } = prev;
                        return rest;
                    });
                }
            };

            const generateOrderText = () => {
                const orderedItems = Object.entries(orders)
                    .map(([itemId, qty]) => {
                        const item = menuItems.find(i => i.id === parseInt(itemId));
                        return item ? { ...item, qty } : null;
                    })
                    .filter(item => item !== null)
                    .sort((a, b) => a.id - b.id);

                if (orderedItems.length === 0) return 'ÊöÇÊó†ÁÇπÈ§ê';

                const itemsList = orderedItems
                    .map((item, index) => `${index + 1}. ${item.name} x${item.qty} (${(item.price * item.qty).toFixed(2)} din)`)
                    .join('\n');
                
                const total = orderedItems.reduce((sum, item) => sum + item.price * item.qty, 0);
                
                return `${itemsList}\n\nÊÄªËÆ°Ôºö${total.toFixed(2)} din`;
            };

            const submitAndCopyOrder = () => {
                const orderedItems = Object.entries(orders)
                    .map(([itemId, qty]) => {
                        const item = menuItems.find(i => i.id === parseInt(itemId));
                        return item ? { ...item, qty } : null;
                    })
                    .filter(item => item !== null);

                if (orderedItems.length === 0) {
                    alert('Ê≤°ÊúâËèúÂìÅÂèØ‰ª•Êèê‰∫§');
                    return;
                }

                // ÁîüÊàêËÆ¢ÂçïÁºñÂè∑ÔºàÊó•Êúü + Â∫èÂè∑Ôºâ
                const today = new Date().toISOString().split('T')[0];
                const todayOrders = orderHistory.filter(order => order.date.startsWith(today));
                const orderNumber = todayOrders.length + 1;
                const orderId = `${today.replace(/-/g, '')}-${orderNumber.toString().padStart(3, '0')}`;

                // ÂàõÂª∫ËÆ¢ÂçïËÆ∞ÂΩï
                const orderRecord = {
                    id: orderId,
                    date: new Date().toISOString(),
                    items: orderedItems,
                    total: orderedItems.reduce((sum, item) => sum + item.price * item.qty, 0),
                    orderNumber: orderNumber
                };

                // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
                setOrderHistory(prev => [orderRecord, ...prev]);

                // ÁîüÊàêËÆ¢ÂçïÊñáÊú¨
                const itemsList = orderedItems
                    .map((item, index) => `${index + 1}. ${item.name} x${item.qty} (${(item.price * item.qty).toFixed(2)} din)`)
                    .join('\n');
                
                const orderText = `ËÆ¢ÂçïÂè∑: ${orderId}\n${itemsList}\n\nÊÄªËÆ°Ôºö${orderRecord.total.toFixed(2)} din`;

                // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                copyToClipboard(orderText);

                // Ê∏ÖÁ©∫ÂΩìÂâçËÆ¢Âçï
                setOrders({});

                alert(`ËÆ¢Âçï ${orderId} Â∑≤Êèê‰∫§Âπ∂Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø`);
            };

            const copyToClipboard = (text) => {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        setCopySuccess(true);
                        setTimeout(() => setCopySuccess(false), 2000);
                    }).catch(() => {
                        fallbackCopyTextToClipboard(text);
                    });
                } else {
                    fallbackCopyTextToClipboard(text);
                }
            };

            const fallbackCopyTextToClipboard = (text) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopySuccess(true);
                    setTimeout(() => setCopySuccess(false), 2000);
                } catch (err) {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                    alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÊñáÊú¨');
                }
                document.body.removeChild(textArea);
            };

            const clearOrders = () => {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâËÆ¢ÂçïÂêóÔºü')) {
                    setOrders({});
                }
            };

            // ÂèñÊ∂àËÆ¢Âçï
            const cancelOrder = (orderId) => {
                if (confirm('Á°ÆÂÆöË¶ÅÂèñÊ∂àËøô‰∏™ËÆ¢ÂçïÂêóÔºü')) {
                    const order = orderHistory.find(o => o.id === orderId);
                    if (order) {
                        // Ê∑ªÂä†Âà∞ÂèñÊ∂àËÆ¢ÂçïËÆ∞ÂΩï
                        setCancelledOrders(prev => [...prev, { ...order, cancelledDate: new Date().toISOString() }]);
                        // ‰ªéÂéÜÂè≤ËÆ¢Âçï‰∏≠ÁßªÈô§
                        setOrderHistory(prev => prev.filter(o => o.id !== orderId));
                    }
                }
            };

            // ÊÅ¢Â§çÂ∑≤ÂèñÊ∂àÁöÑËÆ¢Âçï
            const restoreOrder = (orderId) => {
                const cancelledOrder = cancelledOrders.find(o => o.id === orderId);
                if (cancelledOrder) {
                    // ‰ªéÂèñÊ∂àËÆ¢Âçï‰∏≠ÁßªÈô§
                    setCancelledOrders(prev => prev.filter(o => o.id !== orderId));
                    // ÊÅ¢Â§çÂà∞ÂéÜÂè≤ËÆ¢Âçï
                    setOrderHistory(prev => [cancelledOrder, ...prev]);
                }
            };

            // Ëé∑ÂèñÊÄªÁªìÊï∞ÊçÆ
            const getSummaryData = () => {
                const today = selectedDate.toISOString().split('T')[0];
                
                if (viewMode === 'daily') {
                    // ÂΩìÊó•ËÆ¢ÂçïÔºà‰∏çÂåÖÊã¨ÂèñÊ∂àÁöÑËÆ¢ÂçïÔºâ
                    const dailyOrders = orderHistory.filter(order => order.date.startsWith(today));
                    const totalAmount = dailyOrders.reduce((sum, order) => sum + order.total, 0);
                    
                    // ËèúÂìÅÁªüËÆ°
                    const itemStats = {};
                    dailyOrders.forEach(order => {
                        order.items.forEach(item => {
                            if (!itemStats[item.id]) {
                                itemStats[item.id] = { ...item, totalQty: 0, totalAmount: 0 };
                            }
                            itemStats[item.id].totalQty += item.qty;
                            itemStats[item.id].totalAmount += item.price * item.qty;
                        });
                    });

                    return {
                        orders: dailyOrders,
                        totalOrders: dailyOrders.length,
                        totalAmount: totalAmount,
                        itemStats: Object.values(itemStats).sort((a, b) => b.totalQty - a.totalQty)
                    };
                } else if (viewMode === 'monthly') {
                    // ÊúàÂ∫¶ÁªüËÆ°Ôºà‰∏çÂåÖÊã¨ÂèñÊ∂àÁöÑËÆ¢ÂçïÔºâ
                    const year = selectedDate.getFullYear();
                    const month = selectedDate.getMonth() + 1;
                    const monthPrefix = `${year}-${month.toString().padStart(2, '0')}`;
                    
                    const monthlyOrders = orderHistory.filter(order => order.date.startsWith(monthPrefix));
                    const totalAmount = monthlyOrders.reduce((sum, order) => sum + order.total, 0);
                    
                    // ÊåâÊó•ÊúüÂàÜÁªÑ
                    const dailyStats = {};
                    monthlyOrders.forEach(order => {
                        const date = order.date.split('T')[0];
                        if (!dailyStats[date]) {
                            dailyStats[date] = { date, orders: 0, amount: 0 };
                        }
                        dailyStats[date].orders += 1;
                        dailyStats[date].amount += order.total;
                    });

                    return {
                        orders: monthlyOrders,
                        totalOrders: monthlyOrders.length,
                        totalAmount: totalAmount,
                        dailyStats: Object.values(dailyStats).sort((a, b) => b.date.localeCompare(a.date))
                    };
                } else {
                    // ËèúÂìÅÊÄªÁªüËÆ°Ôºà‰∏çÂåÖÊã¨ÂèñÊ∂àÁöÑËÆ¢ÂçïÔºâ
                    const itemStats = {};
                    orderHistory.forEach(order => {
                        order.items.forEach(item => {
                            if (!itemStats[item.id]) {
                                itemStats[item.id] = { ...item, totalQty: 0, totalAmount: 0 };
                            }
                            itemStats[item.id].totalQty += item.qty;
                            itemStats[item.id].totalAmount += item.price * item.qty;
                        });
                    });

                    return {
                        itemStats: Object.values(itemStats).sort((a, b) => b.totalQty - a.totalQty)
                    };
                }
            };

            // Ëé∑ÂèñÂèñÊ∂àËÆ¢ÂçïÊï∞ÊçÆ
            const getCancelledOrdersData = () => {
                const today = selectedDate.toISOString().split('T')[0];
                
                if (viewMode === 'daily') {
                    // ÂΩìÊó•ÂèñÊ∂àÁöÑËÆ¢Âçï
                    const dailyCancelledOrders = cancelledOrders.filter(order => order.date.startsWith(today));
                    const totalCancelledAmount = dailyCancelledOrders.reduce((sum, order) => sum + order.total, 0);
                    
                    return {
                        orders: dailyCancelledOrders,
                        totalOrders: dailyCancelledOrders.length,
                        totalAmount: totalCancelledAmount
                    };
                } else if (viewMode === 'monthly') {
                    // ÊúàÂ∫¶ÂèñÊ∂àÁöÑËÆ¢Âçï
                    const year = selectedDate.getFullYear();
                    const month = selectedDate.getMonth() + 1;
                    const monthPrefix = `${year}-${month.toString().padStart(2, '0')}`;
                    
                    const monthlyCancelledOrders = cancelledOrders.filter(order => order.date.startsWith(monthPrefix));
                    const totalCancelledAmount = monthlyCancelledOrders.reduce((sum, order) => sum + order.total, 0);
                    
                    return {
                        orders: monthlyCancelledOrders,
                        totalOrders: monthlyCancelledOrders.length,
                        totalAmount: totalCancelledAmount
                    };
                } else {
                    return {
                        orders: [],
                        totalOrders: 0,
                        totalAmount: 0
                    };
                }
            };

            const generateSummaryText = () => {
                const data = getSummaryData();
                const cancelledData = getCancelledOrdersData();
                const dateStr = selectedDate.toLocaleDateString('zh-CN');
                
                if (viewMode === 'daily') {
                    return `üìä ${dateStr} ÈîÄÂîÆÊÄªÁªì\n\n` +
                           `ÊúâÊïàËÆ¢ÂçïÊï∞Èáè: ${data.totalOrders} Âçï\n` +
                           `ÊúâÊïàËÆ¢ÂçïÈáëÈ¢ù: ${data.totalAmount.toFixed(2)} din\n` +
                           `ÂèñÊ∂àËÆ¢ÂçïÊï∞Èáè: ${cancelledData.totalOrders} Âçï\n` +
                           `ÂèñÊ∂àËÆ¢ÂçïÈáëÈ¢ù: ${cancelledData.totalAmount.toFixed(2)} din\n\n` +
                           `ËèúÂìÅÈîÄÂîÆÊéíË°å:\n${data.itemStats.map((item, index) => 
                               `${index + 1}. ${item.name} x${item.totalQty} (${item.totalAmount.toFixed(2)} din)`
                           ).join('\n')}`;
                } else if (viewMode === 'monthly') {
                    const monthStr = selectedDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });
                    return `üìä ${monthStr} ÈîÄÂîÆÊÄªÁªì\n\n` +
                           `ÊúâÊïàËÆ¢Âçï: ${data.totalOrders} Âçï\n` +
                           `ÊúâÊïàËÆ¢ÂçïÈáëÈ¢ù: ${data.totalAmount.toFixed(2)} din\n` +
                           `ÂèñÊ∂àËÆ¢Âçï: ${cancelledData.totalOrders} Âçï\n` +
                           `ÂèñÊ∂àËÆ¢ÂçïÈáëÈ¢ù: ${cancelledData.totalAmount.toFixed(2)} din\n\n` +
                           `ÊØèÊó•ÁªüËÆ°:\n${data.dailyStats.map(day => 
                               `${day.date}: ${day.orders}Âçï ${day.amount.toFixed(2)} din`
                           ).join('\n')}`;
                } else {
                    return `üìä ËèúÂìÅÊÄªÈîÄÂîÆÁªüËÆ°\n\n` +
                           `ÁªüËÆ°Êó∂Èó¥: ${new Date().toLocaleDateString('zh-CN')}\n\n` +
                           `ËèúÂìÅÈîÄÂîÆÊéíË°å:\n${data.itemStats.map((item, index) => 
                               `${index + 1}. ${item.name} x${item.totalQty} (${item.totalAmount.toFixed(2)} din)`
                           ).join('\n')}`;
                }
            };

            const copySummaryToClipboard = () => {
                const text = generateSummaryText();
                copyToClipboard(text);
            };

            // Êó•ÂéÜÁªÑ‰ª∂
            const CalendarView = () => {
                const [currentMonth, setCurrentMonth] = useState(new Date());
                
                const getDaysInMonth = (date) => {
                    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
                };

                const getFirstDayOfMonth = (date) => {
                    return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
                };

                const renderCalendar = () => {
                    const daysInMonth = getDaysInMonth(currentMonth);
                    const firstDay = getFirstDayOfMonth(currentMonth);
                    const days = [];
                    
                    // ‰∏ä‰∏™ÊúàÁöÑÁ©∫Ê†º
                    for (let i = 0; i < firstDay; i++) {
                        days.push(<div key={`empty-${i}`} className="calendar-day"></div>);
                    }
                    
                    // Êú¨ÊúàÊó•Êúü
                    for (let i = 1; i <= daysInMonth; i++) {
                        const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), i);
                        const dateStr = date.toISOString().split('T')[0];
                        const hasOrders = orderHistory.some(order => order.date.startsWith(dateStr));
                        const isSelected = date.toDateString() === selectedDate.toDateString();
                        
                        days.push(
                            <div 
                                key={i}
                                className={`calendar-day flex items-center justify-center cursor-pointer border rounded ${
                                    isSelected ? 'selected bg-blue-500 text-white' : 
                                    hasOrders ? 'bg-green-100' : 'bg-gray-50'
                                } hover:bg-blue-200`}
                                onClick={() => setSelectedDate(date)}
                            >
                                {i}
                            </div>
                        );
                    }
                    
                    return days;
                };

                const changeMonth = (direction) => {
                    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + direction, 1));
                };

                return (
                    <div className="bg-white rounded-lg p-4 mb-4">
                        <div className="flex items-center justify-between mb-4">
                            <button onClick={() => changeMonth(-1)} className="p-2 hover:bg-gray-100 rounded">
                                ‚Äπ
                            </button>
                            <h3 className="font-semibold">
                                {currentMonth.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' })}
                            </h3>
                            <button onClick={() => changeMonth(1)} className="p-2 hover:bg-gray-100 rounded">
                                ‚Ä∫
                            </button>
                        </div>
                        <div className="grid grid-cols-7 gap-1 text-sm text-center">
                            {['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'].map(day => (
                                <div key={day} className="font-medium text-gray-500">{day}</div>
                            ))}
                            {renderCalendar()}
                        </div>
                    </div>
                );
            };

            const groupedMenu = menuItems.reduce((acc, item) => {
                if (!acc[item.category]) acc[item.category] = [];
                acc[item.category].push(item);
                return acc;
            }, {});

            return (
                <div className="flex flex-col h-screen bg-gray-50">
                    {/* ‰∏äÂçäÈÉ®ÂàÜÔºöËèúÂìÅÈÄâÊã© */}
                    <div className="flex-1 overflow-y-auto bg-white">
                        <div className="sticky top-0 bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 shadow-md z-20">
                            <div className="flex items-center justify-between">
                                <h1 className="text-xl font-bold">ÁÇπÈ§êÁ≥ªÁªü</h1>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowSummary(true)}
                                        className="flex items-center gap-1 bg-white text-orange-500 px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-orange-50 transition"
                                    >
                                        <BarChart3 />
                                        ÊÄªÁªì
                                    </button>
                                    <button
                                        onClick={() => setShowEditMode(!showEditMode)}
                                        className={`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-semibold transition ${
                                            showEditMode 
                                                ? 'bg-red-500 text-white' 
                                                : 'bg-white text-orange-500 hover:bg-orange-50'
                                        }`}
                                    >
                                        <Edit3 />
                                        {showEditMode ? 'ÂÆåÊàê' : 'Âà†Èô§ËèúÂìÅ'}
                                    </button>
                                    <button
                                        onClick={() => setShowAddForm(true)}
                                        className="flex items-center gap-1 bg-white text-orange-500 px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-orange-50 transition"
                                    >
                                        <PlusCircle />
                                        Ê∑ªÂä†ËèúÂìÅ
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        {/* Ê∑ªÂä†ËèúÂìÅË°®Âçï */}
                        {showAddForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-30 p-4">
                                <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-bold text-gray-800">Ê∑ªÂä†Êñ∞ËèúÂìÅ</h2>
                                        <button onClick={() => setShowAddForm(false)} className="text-gray-400 hover:text-gray-600">
                                            <X size={24} />
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">ËèúÂêç</label>
                                            <input
                                                type="text"
                                                value={newItem.name}
                                                onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                                                placeholder="ËØ∑ËæìÂÖ•ËèúÂêç"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">‰ª∑Ê†ºÔºàdinÔºâ</label>
                                            <input
                                                type="number"
                                                value={newItem.price}
                                                onChange={(e) => setNewItem({...newItem, price: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                                                placeholder="ËØ∑ËæìÂÖ•‰ª∑Ê†º"
                                                step="0.01"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">ÂàÜÁ±ª</label>
                                            <select
                                                value={newItem.category}
                                                onChange={(e) => {
                                                    const category = e.target.value;
                                                    setNewItem({...newItem, category});
                                                    setShowCustomCategory(category === 'ÂÖ∂‰ªñ');
                                                }}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                                            >
                                                <option value="ÁÉ≠Ëèú">ÁÉ≠Ëèú</option>
                                                <option value="ÂáâËèú">ÂáâËèú</option>
                                                <option value="Ê±§ÂìÅ">Ê±§ÂìÅ</option>
                                                <option value="‰∏ªÈ£ü">‰∏ªÈ£ü</option>
                                                <option value="ÈÖíÊ∞¥È•ÆÊñô">ÈÖíÊ∞¥È•ÆÊñô</option>
                                                <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                                            </select>
                                        </div>

                                        {showCustomCategory && (
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Ëá™ÂÆö‰πâÂàÜÁ±ª</label>
                                                <input
                                                    type="text"
                                                    value={newItem.customCategory}
                                                    onChange={(e) => setNewItem({...newItem, customCategory: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                                                    placeholder="ËØ∑ËæìÂÖ•Ëá™ÂÆö‰πâÂàÜÁ±ªÂêçÁß∞"
                                                />
                                            </div>
                                        )}

                                        <div className="pt-2">
                                            <button
                                                onClick={() => {
                                                    setShowAddForm(false);
                                                    setShowBatchAddForm(true);
                                                }}
                                                className="w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition"
                                            >
                                                ÊâπÈáèÊ∑ªÂä†ËèúÂìÅ
                                            </button>
                                        </div>
                                        
                                        <div className="flex gap-3 mt-6">
                                            <button
                                                onClick={() => setShowAddForm(false)}
                                                className="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition"
                                            >
                                                ÂèñÊ∂à
                                            </button>
                                            <button
                                                onClick={addNewMenuItem}
                                                className="flex-1 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-medium transition"
                                            >
                                                Á°ÆËÆ§Ê∑ªÂä†
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ÊâπÈáèÊ∑ªÂä†ËèúÂìÅË°®Âçï */}
                        {showBatchAddForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-30 p-4">
                                <div className="bg-white rounded-lg p-6 w-full max-w-2xl">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-bold text-gray-800">ÊâπÈáèÊ∑ªÂä†ËèúÂìÅ</h2>
                                        <button onClick={() => setShowBatchAddForm(false)} className="text-gray-400 hover:text-gray-600">
                                            <X size={24} />
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                ËØ∑ËæìÂÖ•ËèúÂìÅ‰ø°ÊÅØÔºàÊØèË°å‰∏Ä‰∏™ËèúÂìÅÔºåÊ†ºÂºèÔºöËèúÂêç ‰ª∑Ê†ºÔºâ
                                            </label>
                                            <textarea
                                                value={batchText}
                                                onChange={(e) => setBatchText(e.target.value)}
                                                className="w-full h-64 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 font-mono text-sm"
                                                placeholder={`‰æãÂ¶ÇÔºö
ÂÆ´‰øùÈ∏°‰∏Å 38
È±ºÈ¶ôËÇâ‰∏ù 32
È∫ªÂ©ÜË±ÜËÖê 28
ÂèØ‰πê 5
Âï§ÈÖí 8`}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">ÂàÜÁ±ª</label>
                                            <select
                                                value={batchCategory}
                                                onChange={(e) => setBatchCategory(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                                            >
                                                <option value="ÁÉ≠Ëèú">ÁÉ≠Ëèú</option>
                                                <option value="ÂáâËèú">ÂáâËèú</option>
                                                <option value="Ê±§ÂìÅ">Ê±§ÂìÅ</option>
                                                <option value="‰∏ªÈ£ü">‰∏ªÈ£ü</option>
                                                <option value="ÈÖíÊ∞¥È•ÆÊñô">ÈÖíÊ∞¥È•ÆÊñô</option>
                                                <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                                            </select>
                                        </div>
                                        
                                        <div className="flex gap-3 mt-6">
                                            <button
                                                onClick={() => setShowBatchAddForm(false)}
                                                className="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition"
                                            >
                                                ÂèñÊ∂à
                                            </button>
                                            <button
                                                onClick={batchAddMenuItems}
                                                className="flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition"
                                            >
                                                ÊâπÈáèÊ∑ªÂä†
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* ÊÄªÁªìÈ°µÈù¢ */}
                        {showSummary && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-30 p-4">
                                <div className="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className="text-xl font-bold text-gray-800">ÈîÄÂîÆÊÄªÁªì</h2>
                                        <button onClick={() => setShowSummary(false)} className="text-gray-400 hover:text-gray-600">
                                            <X size={24} />
                                        </button>
                                    </div>

                                    {/* Êó•ÂéÜÂíåËßÜÂõæÂàáÊç¢ */}
                                    <div className="mb-6">
                                        <CalendarView />
                                        
                                        <div className="flex gap-2 mb-4">
                                            <button
                                                onClick={() => setViewMode('daily')}
                                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                                    viewMode === 'daily' 
                                                        ? 'bg-blue-500 text-white' 
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                Êó•ÁªüËÆ°
                                            </button>
                                            <button
                                                onClick={() => setViewMode('monthly')}
                                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                                    viewMode === 'monthly' 
                                                        ? 'bg-blue-500 text-white' 
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                ÊúàÁªüËÆ°
                                            </button>
                                            <button
                                                onClick={() => setViewMode('items')}
                                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                                    viewMode === 'items' 
                                                        ? 'bg-blue-500 text-white' 
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                ËèúÂìÅÁªüËÆ°
                                            </button>
                                        </div>

                                        <div className="flex gap-2 mb-4">
                                            <button
                                                onClick={() => setShowCancelledOrders(!showCancelledOrders)}
                                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                                    showCancelledOrders 
                                                        ? 'bg-red-500 text-white' 
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {showCancelledOrders ? 'ÈöêËóèÂèñÊ∂àËÆ¢Âçï' : 'ÊòæÁ§∫ÂèñÊ∂àËÆ¢Âçï'}
                                            </button>
                                        </div>
                                    </div>

                                    {/* ÊÄªÁªìÂÜÖÂÆπ */}
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-semibold text-gray-700">
                                                {viewMode === 'daily' && `${selectedDate.toLocaleDateString('zh-CN')} ÈîÄÂîÆÊÄªÁªì`}
                                                {viewMode === 'monthly' && `${selectedDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' })} ÈîÄÂîÆÊÄªÁªì`}
                                                {viewMode === 'items' && 'ËèúÂìÅÈîÄÂîÆÊÄªÁªüËÆ°'}
                                            </h3>
                                            <button
                                                onClick={copySummaryToClipboard}
                                                className="px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm flex items-center gap-1 transition"
                                            >
                                                <Copy size={14} />
                                                Â§çÂà∂ÊÄªÁªì
                                            </button>
                                        </div>
                                        
                                        <pre className="text-sm text-gray-700 whitespace-pre-wrap font-mono">
                                            {generateSummaryText()}
                                        </pre>
                                    </div>

                                    {/* ÂéÜÂè≤ËÆ¢ÂçïÂàóË°® */}
                                    {viewMode === 'daily' && (
                                        <div className="mt-6">
                                            <h4 className="font-semibold text-gray-700 mb-3">
                                                {showCancelledOrders ? 'ÂèñÊ∂àËÆ¢ÂçïËØ¶ÊÉÖ' : 'ÂΩìÊó•ËÆ¢ÂçïËØ¶ÊÉÖ'}
                                            </h4>
                                            <div className="space-y-2 max-h-60 overflow-y-auto">
                                                {(showCancelledOrders ? getCancelledOrdersData().orders : getSummaryData().orders).map(order => (
                                                    <div key={order.id} className="bg-white border rounded-lg p-3">
                                                        <div className="flex justify-between items-start mb-2">
                                                            <span className="font-medium">ËÆ¢ÂçïÂè∑: {order.id}</span>
                                                            <div className="flex gap-2">
                                                                <span className="text-orange-600 font-semibold">{order.total.toFixed(2)} din</span>
                                                                {showCancelledOrders ? (
                                                                    <button
                                                                        onClick={() => restoreOrder(order.id)}
                                                                        className="px-2 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-xs transition"
                                                                    >
                                                                        ÊÅ¢Â§ç
                                                                    </button>
                                                                ) : (
                                                                    <button
                                                                        onClick={() => cancelOrder(order.id)}
                                                                        className="px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-xs transition"
                                                                    >
                                                                        ÂèñÊ∂à
                                                                    </button>
                                                                )}
                                                            </div>
                                                        </div>
                                                        <div className="text-sm text-gray-600">
                                                            {order.items.map(item => 
                                                                `${item.name} x${item.qty}`
                                                            ).join(', ')}
                                                        </div>
                                                        {showCancelledOrders && order.cancelledDate && (
                                                            <div className="text-xs text-red-500 mt-1">
                                                                ÂèñÊ∂àÊó∂Èó¥: {new Date(order.cancelledDate).toLocaleString('zh-CN')}
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        <div className="p-4 space-y-6">
                            {Object.entries(groupedMenu).map(([category, items]) => (
                                <div key={category}>
                                    <h2 className="text-lg font-semibold text-gray-700 mb-3 pb-2 border-b-2 border-orange-400">
                                        {category}
                                    </h2>
                                    <div className="space-y-2">
                                        {items.map(item => (
                                            <div key={item.id} className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                                                <div className="flex-1">
                                                    <span className="text-gray-800 font-medium">{item.name}</span>
                                                    <span className="text-orange-600 font-semibold ml-2">{item.price} din</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    {showEditMode ? (
                                                        <button
                                                            onClick={() => deleteMenuItem(item.id)}
                                                            className="px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition"
                                                        >
                                                            Âà†Èô§
                                                        </button>
                                                    ) : (
                                                        <>
                                                            {orders[item.id] > 0 && (
                                                                <>
                                                                    <button
                                                                        onClick={() => updateQuantity(item.id, -1)}
                                                                        className="w-8 h-8 flex items-center justify-center bg-gray-200 hover:bg-gray-300 rounded-full transition"
                                                                    >
                                                                        <Minus />
                                                                    </button>
                                                                    <span className="w-8 text-center font-semibold text-orange-600">
                                                                        {orders[item.id]}
                                                                    </span>
                                                                </>
                                                            )}
                                                            <button
                                                                onClick={() => updateQuantity(item.id, 1)}
                                                                className="w-8 h-8 flex items-center justify-center bg-orange-500 hover:bg-orange-600 text-white rounded-full transition"
                                                            >
                                                                <Plus />
                                                            </button>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ‰∏ãÂçäÈÉ®ÂàÜÔºöËÆ¢ÂçïÊñáÊú¨ */}
                    <div className="h-64 bg-white border-t-4 border-orange-500 shadow-lg">
                        <div className="h-full flex flex-col">
                            <div className="flex items-center justify-between p-3 bg-gray-100 border-b">
                                <h3 className="font-semibold text-gray-700">ËÆ¢ÂçïËØ¶ÊÉÖ</h3>
                                <div className="flex gap-2">
                                    <button
                                        onClick={clearOrders}
                                        className="px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm flex items-center gap-1 transition"
                                    >
                                        <Trash2 />
                                        Ê∏ÖÁ©∫
                                    </button>
                                    <button
                                        onClick={submitAndCopyOrder}
                                        className="px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm flex items-center gap-1 transition"
                                    >
                                        <Copy />
                                        Êèê‰∫§Âπ∂Â§çÂà∂
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto p-4">
                                <pre className="text-sm text-gray-700 whitespace-pre-wrap font-mono">
                                    {generateOrderText()}
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Ê∏≤ÊüìÂ∫îÁî®Âà∞È°µÈù¢
        ReactDOM.render(<MenuOrderApp />, document.getElementById('root'));
    </script>
</body>
</html>
